# IDT for AWS IoT Greengrass Troubleshooting<a name="idt-troubleshooting"></a>

IDT for AWS IoT Greengrass writes these errors to various locations based on the type of errors\. Errors are written to the console, log files, and test reports\.

## Error Codes<a name="bk-error-codes"></a>

The following table lists the error codes generated by IDT for AWS IoT Greengrass\.


| Error Code | Error Code Name | Possible Root Cause | Troubleshooting | 
| --- | --- | --- | --- | 
|  101  |  InternalError  |  An internal error occurred\.  |   Check logs under the `<device-tester-extract-location>/results` directory\. If you cannot debug the issue, contact [AWS Developer Support](https://aws.amazon.com/premiumsupport/plans/developers/)\.  | 
|  102  |  TimeoutError  |  The test cannot be completed in a limited time range\. This can happen if: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html)  |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html)  | 
|  103  |  PlatformNotSupportError  |  Incorrect OS/architecture combination specified in `device.json`\.  |  Change your configuration to one of the supported combinations: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html) For more information, see [Device Configuration](set-config.md#device-config)\.  | 
|  104  |  VersionNotSupportError  |  The AWS IoT Greengrass Core software version is not supported by the version of IDT you are using\.  |  Use the device\_tester\_bin version command to find the supported version of the AWS IoT Greengrass Core software\. For example, if you are using macOS, use \./devicetester\_mac\_x86\_64 version\. To find the version of AWS IoT Greengrass Core software you are using: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html) You can test a different version of the AWS IoT Greengrass Core software\. For more information, see [Getting Started with AWS IoT Greengrass](gg-gs.md)\.  | 
|  105  |  LanguageNotSupportError  |  IDT supports Python for AWS IoT Greengrass libraries and SDKs only\.  |  Make sure: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html)  | 
|  106  |  ValidationError  |  Some fields in `device.json` or `config.json` are invalid\.  |  Check the error message on the right side of the error code in the report\.  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html)  | 
|  107  |  SSHConnectionFailed  |  The test machine cannot connect to the configured device\.  |  Verify the following fields in your `device.json` file are correct: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html) For more information, see [Device Configuration](set-config.md#device-config)\.  | 
|  108  |  RunCommandError  |  A test failed to execute a command on the device under test\.  |  Verify that root access is allowed for the configured user in `device.json`\. A password is required by some devices when executing commands with root access\. Make sure root access is allowed without a password\. For more information, consult the documentation for your device\. Try running the failing command manually on your device to see if an error occurs\.  | 
|  109  |  PermissionDeniedError  |  No root access\.  |  Set root access for the configured user on your device\.  | 
|  110  |  CreateFileError  |  Unable to create a file\.  |  Check your device's disk space and directory permissions\.  | 
|  111  |  CreateDirError  |  Unable to create a directory\.  |  Check your device's disk space and directory permissions\.  | 
|  112  |  InvalidPathError  |  The path to the AWS IoT Greengrass Core software is incorrect\.  |  Verify that the path in the error message is valid\. Do not edit any files under the `devicetester_greengrass_<os>` directory\.  | 
|  113  |  InvalidFileError  |  A file is invalid\.  |  Verify that the file in the error message is valid\.  | 
|  114  |  ReadFileError  |  The specified file cannot be read\.  |  Verify the following: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html) If you are testing on macOS, increase the open files limit\. The default limit is 256, which is enough for testing\.  | 
|  115  |  FileNotFoundError  |  A required file was not found\.  |  Verify the following: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html)  | 
|  116  |  OpenFileFailed  |  Unable to open the specified file\.  |  Verify the following: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html) If you are testing on macOS, increase the open files limit\. The default limit is 256, which is enough for testing\.  | 
|  117  |  WriteFileFailed  |  Failed to write file \(can be the DUT or test machine\)\.  |  Try to manually create a file in the directory specified in the error message\.  | 
|  118  |  FileCleanUpError  |  A test failed to remove the specified file or directory or to umount the specified file on the remote device\.  |  If the binary file is still running, the file might be locked\. End the process and delete the specified file\.  | 
|  119  |  InvalidInputError  |  Invalid configuration\.  |  Verify your `suite.json` file is valid\.  | 
|  120  |  InvalidCredentialError  |  Invalid AWS credentials\.  |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html)  | 
|  121  |  AWSSessionError  |  Failed to create an AWS session\.  |  This error can occur if AWS credentials are invalid or the internet connection is unstable\. Try using the AWS CLI to call an AWS API operation\.  | 
|  122  |  AWSApiCallError  |  An AWS API error occurred\.  |  This error might be due to a network issue\. Check your network before retrying the test group\.  | 
|  123  |  IpNotExistError  |   IP address is not included in connectivity information\.  |  Check your internet connection\. You can use the AWS IoT Greengrass console to check the connectivity information for the AWS IoT Greengrass core thing that is being used by the test\. If there are 10 endpoints included in the connectivity information, you can remove some or all of them and rerun the test\. For more information, see [Connectivity Information](https://docs.aws.amazon.com/cli/latest/reference/greengrass/get-connectivity-info.html)\.  | 
|  124  |  OTAJobNotCompleteError  |  An OTA job did not complete\.  |  Check your internet connection and retry the OTA test group\.  | 
|  125  |  CreateGreengrassServiceRoleError  |  One of the following occurred: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html)  |  Configure the AWS IoT Greengrass service role\. For more information, see [Greengrass Service Role](service-role.md)\.  | 
|  126  |  DependenciesNotPresentError  |  One or more dependencies required for the specific test are not present on the device\.  |  Check the test log to see which dependencies are missing on your device: `<device-tester-extract-location>/results/<execution-id>/logs/<test-case-name.log>`  | 
|  127  |  InvalidHSMConfiguration  |  The provided HSM/PKCS configuration is incorrect\.  |  In your `device.json` file, provide the configuration required to interact with the HSM using PKCS\#11\.  | 
|  128  |  OTAJobNotSuccededError  |  The OTA job did not succeed\.  |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html)  | 
|  129  |  NoConnectivityError  |  The host agent is failing to connect to internet\.  |  Check your network connection and firewall settings\. Retry the test group after the connectivity issue is resolved\.  | 
|  130  |  NoPermissionError  |  The IAM user you are using to run IDT for AWS IoT Greengrass does not have permission to create the AWS resources required to run IDT\.  |  See [Permissions Policy Template](https://docs.aws.amazon.com/greengrass/latest/developerguide/policy-template.html) for the policy template that grants the permissions required to run IDT for AWS IoT Greengrass\.  | 
|  131  |  LeftoverAgentExistError  |  Your device is running AWS IoT Greengrass processes when you attempt to start IDT for AWS IoT Greengrass\.   |  Make sure there is no existing Greengrass daemon running on your device\. [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/greengrass/latest/developerguide/idt-troubleshooting.html)  If you are using an existing installation of AWS IoT Greengrass configured to start automatically after reboot, you need to stop the daemon after reboot and before running the test suite\.   | 

## Resolving IDT for AWS IoT Greengrass Errors<a name="idt-gg-resolve-errors"></a>

When you use IDT, you must get the correct configuration files in place before you run IDT for AWS IoT Greengrass\. If you are getting parsing and configuration errors, your first step is to locate and use a configuration template appropriate for your environment\.

If you are still having issues, see the following debugging process\.

### Where Do I Look?<a name="where-to-look"></a>

High\-level errors are displayed on the console during execution, and a summary of the failed tests with the error is displayed when all tests are complete\. `awsiotdevicetester_report.xml` contains a summary of all the errors that caused a test to fail\. The log files for each test run are stored in a directory named with an UUID for the test execution that was displayed on the console during the test run\.

The test logs directory is located in `<device-tester-extract-location>/results /<uuidexecution-id>/logs/`\. This directory contains the following files, which are useful for debugging\.


| File | Description | 
| --- | --- | 
| test\_manager\.log |  All of the logs that were written to the console during the test execution\. A summary of the results is located at the end of this file, which includes a list of which tests failed\. The warning and error logs in this file can give you some information about the failures\.   | 
| <test\-name>\.log | Detailed logs for the specific test\. | 
| <test\-name>\_ggc\_logs\.tar\.gz | A compressed collection of all the logs the AWS IoT Greengrass core daemon generated during the test\. For more information, see [Troubleshooting AWS IoT Greengrass](https://docs.aws.amazon.com/greengrass/latest/developerguide/gg-troubleshooting.html)\. | 
| <test\-name>\_ota\_logs\.tar\.gz | A compressed collection of logs generated by the AWS IoT Greengrass OTA agent during the test\. For OTA tests only\. | 
| <test\-name>basic\_assertion\_publisher\_ggad\_logs\.tar\.gz | A compressed collection of logs generated by the AWS IoT publisher device during the test\. Generated by the IDT v2\.0\.0 MQTT tests\.  | 
| <test\-name>basic\_assertion\_subscriber\_ggad\_logs\.tar\.gz | A compressed collection of logs generated by the AWS IoT subscriber device during the test\. Generated by the IDT v2\.0\.0 MQTT tests\.  | 

### Parsing Errors<a name="parse-error"></a>

Occasionally, a typo in a JSON configuration can lead to parsing errors\. Most of the time, the issue is a result of omitting a bracket, comma, or quotation mark from your JSON file\. IDT performs JSON validation and prints debugging information\. It prints the line where the error occurred, the line number, and the column number of the syntax error\. This information should be enough to help you fix the error, but if you still cannot locate the error, you can perform validation manually in your IDE, a text editor such as Atom or Sublime, or through an online tool like JSONLint\.

### Required Parameter Missing Error<a name="param-missing"></a>

Because new features are being added to IDT, changes to the configuration files might be introduced\. Using an old configuration file might break your configuration\. If this happens, the `<test_case_id>.log` file under `/results/<uuid>/logs` explicitly lists all missing parameters\. IDT also validates your JSON configuration file schemas to ensure that the latest supported version has been used\.

### Could Not Start Test Error<a name="could-not-start-test"></a>

You might encounter errors that point to failures during test start\. There are several possible causes, so do the following:
+ Make sure that the pool name you included in your execution command actually exists\. The pool name is referenced directly from your `device.json` file\.
+ Make sure that the devices in your pool have correct configuration parameters\.

### Permission Denied Errors<a name="pwd-sudo"></a>

IDT performs operations on various directories and files in a device under test\. Some of these operations require root access\. To automate these operations, IDT must be able to run commands with sudo without typing a password\. 

Follow these steps to allow sudo access without typing a password\.

**Note**  
`user` and `username` refer to the SSH user used by IDT to access the device under test\.

1. Use sudo usermod \-aG sudo *<ssh\-username>* to add your SSH user to the sudo group\.

1. Sign out and then sign in for changes to take effect\.

1. Open `/etc/sudoers` file and add the following line to the end of the file: `<ssh-username> ALL=(ALL) NOPASSWD: ALL`
**Note**  
As a best practice, we recommend that you use sudo visudo when you edit `/etc/sudoers`\.

### SSH Connection Errors<a name="ssh-connect-errors"></a>

When IDT cannot connect to a device under test, connection failures are logged in `/results/<uuid>/logs/<test-case-id>.log`\. SSH failure messages appear at the top of this log file because connecting to a device under test is one of the first operations that IDT performs\.

Most Windows setups use the PuTTy terminal application to connect to Linux hosts\. This application requires that standard PEM private key files are converted into a proprietary Windows format called PPK\. When IDT is configured in your `device.json` file, use PEM files only\. If you use a PPK file, IDT cannot create an SSH connection with the AWS IoT Greengrass device and cannot run tests\.

### Timeout Errors<a name="test-timeout"></a>

You can increase the timeout for each test by specifying a timeout multiplier, which is applied to the default value of each test's timeout\. Any value configured for this flag must be greater than or equal to 1\.0\.

To use the timeout multiplier, use the flag `--timeout-multiplier` when running the tests\. For example:

\./devicetester\_linux run\-suite \-\-suite\-id GGQ\_1 \-\-pool\-id DevicePool1 \-\-timeout\-multiplier 2\.5

For more information, run run\-suite \-\-help\.

### Command Not Found Errors While Testing OTA<a name="cmd-not-found"></a>

You need an older version of the OpenSSL library \(libssl1\.0\.0\) to run OTA tests on AWS IoT Greengrass devices\. Most current Linux distributions use libssl version 1\.0\.2 or later \(v1\.1\.0\)\. These versions are not compatible with OTA\. 

For example, on a Raspberry Pi, run the following commands to install the required version of libssl:

1. wget http://ftp\.us\.debian\.org/debian/pool/main/o/openssl/libssl1\.0\.0\_1\.0\.2l\-1\~bpo8\+1\_armhf\.deb

1. sudo dpkg \-i libssl1\.0\.0\_1\.0\.2l\-1\~bpo8\+1\_armhf\.deb